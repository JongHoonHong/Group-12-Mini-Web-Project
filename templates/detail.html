<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>$(p_park) 정보</title>
    <script type="text/javascript"
            src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=40yvaf0arj&submodules=geocoder"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: rgb(74, 112, 87);
            min-height: 100vh;
        }
        .wrap {
            width: 90%;
            max-width: 750px;
            margin: 0 auto;
        }

        .banner {
            width: 100%;
            height: 20vh;
            background-color: cadetblue;
            background-position: center;
            background-size: contain;
            background-repeat: repeat;

        }

        h1.title {
            font-family: 'Jua', sans-serif;

            color: white;
            font-size: 3rem;
        }

        h5 {
            font-family: 'Jua', sans-serif;
        }

        .card-title, .card-subtitle {
            display: inline;
        }

        .card {
            width: 50%;
            height: 50vh;
            margin: 10px auto 10px auto;
            border: 1px solid black;
            border-radius: 5px;
            float: left;
        }

        .card-body {
            overflow: auto;
        }

        .card-title {
            display: inline;
        }

        .card-text {
            font-size: 14px;
            letter-spacing: -2px;
            margin: 0;
        }


        #map {
            width: 60%;
            height: 50vh;
            margin: 10px auto 10px auto;
            float: right;
            border-radius: 5px;
            border: 1px solid black;
        }

        .btn-sparta {
            color: #fff;
            background-color: #e8344e;
            border-color: #e8344e;
        }

        .iw-inner {
            padding: 10px;
            font-size: smaller;
        }

        i {
            color: #e8344e;
        }

        i:hover {
            cursor: pointer;
        }

    </style>
    <script>
        let y_cen = 37.5501402;   // latitutde
        let x_cen = 126.9903773;  // longitude
        let map;
        let markers = [];
        let infowindows = [];
        $(document).ready(function () {
            map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(y_cen, x_cen),
                zoom: 12,
                zoomControl: true,
                zoomControlOptions: {
                    style: naver.maps.ZoomControlStyle.SMALL,
                    position: naver.maps.Position.TOP_RIGHT
                }
            });

            get_park_info()
        });

        function get_park_info() {
            for (let i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
                infowindows[i].close()
            }
            markers = [];
            infowindows = [];

            $.ajax({
                type: "GET",
                url: `/park_info`,
                data: {},
                success: function (response) {
                    let parks = response["park_info_list"];
                    console.log(parks.length);
                    for (let i = 0; i < parks.length; i++) {
                        let park = parks[i];
                        make_card(i, parks);
                        let marker = make_marker(park);
                        add_info(i, marker, park)
                    }
                }
            });
        }

        function make_marker(park) {
            let marker_img = '{{ url_for("static", filename="marker-default.png") }}';
            let marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(park["latitude"], park["longitude"]),
                map: map,
                icon: marker_img
            });
            markers.push(marker);
            return marker
        }

        function make_card(i, park) {
            let html_temp = `<div class="card" id="card-${i}">
                                    <div class="card-body">
                                        <h5 class="card-title"><a href="javascript:click2center(${i})" class="matjip-title">${park['p_park']}</a></h5>
                                        <h6 class="card-subtitle mb-2 text-muted">${park['p_zone']}</h6>
                                        <i class="fa fa-bookmark" onclick="bookmark('${park['p_park']}', '${park['p_addr']}')"></i>
                                        <p class="card-text">${park['p_addr']}</p>
                                        <p class="card-text" style="color:blue;">${park['main_equip']}</p>
                                    </div>
                                 </div>`;

        }

        function add_info(i, marker, matjip) {
            let html_temp = `<div class="iw-inner">
                                    <h5>${park['p_park']}</h5>
                                    <p>${park['p_addr']}
                                    </div>`;
            let infowindow = new naver.maps.InfoWindow({
                content: html_temp,
                maxWidth: 200,
                backgroundColor: "#fff",
                borderColor: "#888",
                borderWidth: 2,
                anchorSize: new naver.maps.Size(15, 15),
                anchorSkew: true,
                anchorColor: "#fff",
                pixelOffset: new naver.maps.Point(10, -10)
            });
            infowindows.push(infowindow);
            naver.maps.Event.addListener(marker, "click", function (e) {
                console.log("clicked", infowindows.length);
                if (infowindow.getMap()) {
                    infowindow.close();
                } else {
                    infowindow.open(map, marker);
                    map.setCenter(infowindow.position);
                }
            });
        }

        function click2center(i) {
            let marker = markers[i];
            let infowindow = infowindows[i];
            if (infowindow.getMap()) {
                infowindow.close();
            } else {
                infowindow.open(map, marker);
                map.setCenter(infowindow.position)
            }
        }

    </script>

</head>

<body>
<div class="wrap">
    <div class="banner">
        <div class="d-flex flex-column align-items-center"
             style="background-color: rgba(0,0,0,0.5);width: 100%;height: 100%;">
<!--            p_park-->
            <h1 class="title mt-5 mb-2">${park['p_park']}</h1>
            <button type="button" onclick="get_park_info()" class="btn btn-sparta">
                리뷰작성하기
            </button>
        </div>
    </div>
    <div class="card" style="width: 18rem;">
        <!--    공원 이미지 p_img-->
        <img src="http://parks.seoul.go.kr/file/info/view.do?fIdx=1884" class="card-img-top" alt="...">
        <div class="card-body">
            <!--            공원 주소 p_addr-->
            <h5 class="card-title">서울특별시 중구 삼일대로 231(예장동)</h5>
            <!--       주요 장비 main_equip    -->
            <p class="card-text">奉恩寺 도심 한가운데 있는 奉恩寺는 그 외형적 규모뿐 아니라 역사적으로 서울의 대표적인 사찰로 알려져 있다. 일제시대에는 서울과 경기 일원의 80여 사찰을
                관장하던 본사였고 조선시대에는 억불정책에도 불구하고 선종의 수사찰(首寺刹)로 한국불교의 명맥을 유지하는데 결정적 공헌을 해온 곳이다. 선불당(選佛堂) 봉은사 대웅전 한단 아래 왼쪽에
                자리잡고 있는 선불당은 대중을 위한 禪房으로1941년 심검당이 있던 자리에 중건된 것이다. 선불당은 계율을 일러주는 곳 혹은 선법.교법을 닦는 곳이다. 秋史 金正喜의 '板殿' 현판
                (서울시 유형문화재 제76호: 1991년 5월28일 지정) 봉은사에 있는 화엄경소를 비롯한 15종 3438매의 많은 목판본을 보관하기 위하여 세워진 전각인 판전의 정면 어칸의 처마에 걸려
                있는 편액이다. 이 편액은 추사 김정희(1786~1856?)의 말년 작품으로 왼쪽에 세로로 '칠십일과병중작(칠십일과병중작)'이라 쓰여진 바와 같이 그가 71세때 병중에 쓴 글씨로
                유명하다. 대방광불화엄경(大方廣佛華嚴經) 수소연의 초판 (서울시 유형문화재 제84호: 1992년 12월28일 지정) 봉은사 판전에 보관되어 있는 총 15종 3438판의 목판본 중
                3133판이 바로 대방광불화엄경이다. 대승불교의 대표적 경전이라 할 수 있는 이 화엄경판은 처음 중국 당나라의 실차난타와 징관이 각각 번역하고 찬한 것으로 흔히 '화엄경'으로 줄여
                부른다. 주된 내용은 부처님이 성도한 깨달음의 내용을 그대로 나타내고 있는 경전으로 여러 대승불교의 경전 가운데서도 교학적.사상적으로 불교의 핵심을 가장 깊게 담고 있다는 평가를 받고
                있다.</p>
        </div>
    </div>
    <div id="map"></div>

    </div>
</div>

</body>

</html>